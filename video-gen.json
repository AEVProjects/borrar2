{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "msi-video-gen",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        54400,
        3984
      ],
      "id": "e403b818-9dad-4efd-94f8-1eb27485f6f3",
      "name": "Webhook - Video Gen",
      "webhookId": "msi-video-gen"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\n\nconsole.log('==== RECEIVED WEBHOOK DATA ====');\nconsole.log('Full input:', JSON.stringify(input, null, 2));\n\nlet data;\n\n// Handle different input formats\nif (input.body) {\n  if (typeof input.body === 'string') {\n    try { \n      data = JSON.parse(input.body); \n      console.log('Parsed body as JSON');\n    } catch (e) { \n      data = input.body; \n      console.log('Body is string, not JSON');\n    }\n  } else if (typeof input.body === 'object') {\n    data = input.body;\n    console.log('Body is already object');\n  } else { \n    data = input; \n  }\n} else if (input.query) {\n  data = input.query;\n  console.log('Using query params');\n} else {\n  data = input;\n  console.log('Using raw input');\n}\n\n// Extract parameters with fallbacks\nconst prompt = data.prompt || data.video_prompt || data.text || '';\nconst requestedDuration = parseInt(data.duration || '16');\n// Veo image_to_video only supports 4,6,8 seconds. For >8s, we generate 8s then extend\nconst initialDuration = requestedDuration > 8 ? 8 : requestedDuration;\nconst needsExtension = requestedDuration > 8;\nconst extensionSeconds = needsExtension ? (requestedDuration - 8) : 0;\nconst duration = String(initialDuration);\nconst aspect_ratio = data.aspect_ratio || data.aspectRatio || '9:16';\nconst style = data.style || 'cinematic';\nconst service = data.service || 'company_intro';\nconst post_id = data.post_id || data.postId || null;\nconst topic = data.topic || '';\nconst logo_url = data.logo_url || null;\nconst start_image_url = data.start_image_url || null;\n\nconsole.log('Extracted data:', { prompt, requestedDuration, initialDuration, needsExtension, extensionSeconds, duration, aspect_ratio, style, service, post_id, topic, logo_url, start_image_url });\nconsole.log('==== END WEBHOOK DATA ====');\n\nif (!prompt || prompt.length < 3) {\n  throw new Error('VIDEO GEN ERROR: prompt is required and must be at least 3 characters.');\n}\n\nreturn [{ \n  json: { \n    prompt, \n    duration, \n    requested_duration: requestedDuration,\n    needs_extension: needsExtension,\n    extension_seconds: extensionSeconds,\n    aspect_ratio, \n    style, \n    service,\n    post_id, \n    topic,\n    logo_url,\n    start_image_url\n  } \n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        54624,
        3984
      ],
      "id": "14619088-ccd9-406b-9376-1133b57cd1be",
      "name": "Format Video Input"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "==\"You are a video prompt engineer for Google Veo 3.1 specialized in MSI Technologies corporate content.\n\n## ABOUT MSI TECHNOLOGIES\nMSI Technologies is a B2B technology company that helps businesses modernize their infrastructure and implement innovative technology solutions. Key services include:\n- Cloud Computing & Infrastructure Modernization\n- Cybersecurity Solutions\n- AI/ML Implementation\n- DevOps & IT Consulting\n- Digital Transformation\n\nTarget audience: CTOs, IT Directors, and enterprise decision-makers.\nBrand colors: Primary Blue #207CE5, Secondary Blue #004AAD, Accent/Text #FFFDF1, Dark #2B2B2B\nBrand fonts: ITC Avant Garde Bold (headlines), Poppins SemiBold (subtitles), Quicksand Medium (body)\nContact: contact@msitechnologiesinc.com | msitechnologiesinc.com\n\n## SELECTED SERVICE FOCUS: \" + {\n  company_intro: \"Company Introduction - Showcase MSI Technologies as a leading B2B tech partner helping enterprises modernize and innovate.\",\n  data_security: \"Data Security and Cloud Computing - We use the right tools to ensure security and modernize infrastructure. Focus on enterprise cloud solutions, data protection, and infrastructure modernization.\",\n  bpo: \"Business Process Outsourcing - Leave the non-core tasks to us so you can focus on what really matters. Highlight process optimization, workflow automation, and operational efficiency.\",\n  it_cybersecurity: \"IT Management and Cybersecurity - Advanced security to protect your business and ensure data integrity. Emphasize threat protection, security monitoring, and compliance.\",\n  it_outsourcing: \"IT Outsourcing Solutions - Tap into a global pool of talented professionals without hiring in-house. Show skilled tech teams, remote collaboration, and scalable talent solutions.\",\n  ai_solutions: \"AI and Smart Business Solutions - We empower companies to automate routine tasks and drive innovation. Focus on machine learning, intelligent automation, and AI-driven insights.\",\n  executive_consulting: \"Executive Consulting - We help organizations navigate complexity, drive performance, and stay ahead in the market. Highlight strategic planning, digital transformation roadmaps, and C-level advisory.\"\n}[$json.service] + \"\n\nUSER REQUEST: \" + $json.prompt + \"\nTOPIC: \" + ($json.topic || \"Corporate tech\") + \"\nDURATION: \" + $json.duration + \" seconds\nASPECT RATIO: \" + $json.aspect_ratio + \"\n\n\" + ($json.start_image_url ? \n\"MODE: ANIMATE THE PROVIDED IMAGE\n\nThe user uploaded an image that ALREADY contains the MSI Technologies logo. Your job is to bring this image to life with motion and animation.\n\nCRITICAL - MSI Technologies Logo:\n- The MSI Technologies logo is ALREADY in the reference image\n- Use the EXACT logo as it appears in the image as reference\n- If the logo needs to appear elsewhere in the video, use the SAME design WITHOUT modifications\n- The logo position and style from the reference image is correct - respect it\n- Do NOT move, resize, or alter the logo that's already in the image\n\nAnimation Instructions:\n- Describe how the camera moves through the scene (slow push forward, pan left to right, crane up, etc)\n- Add realistic motion: people moving naturally, talking with lips perfectly synced to dialogue, screens updating, subtle environmental movement\n- When people speak, always specify: lips synced saying [exact words]\n- Include text appearing on physical objects like monitors, wall displays, or signage - use ITC Avant Garde font for titles and Poppins for subtitles in MSI colors #207CE5 or #004AAD\n- Lighting should evolve smoothly: morning light warming, screen glow intensifying, shadows shifting\n\nMANDATORY CALL TO ACTION (LAST 3-4 SECONDS):\n- Before the fade out, display a clear CTA on screen or spoken by a person\n- CTA must include contact info: contact@msitechnologiesinc.com or msitechnologiesinc.com\n- Examples: 'Contact us today', 'Schedule your consultation', 'Let us help transform your business'\n- Use professional executive voice or clean text overlay on screen\n\n- ENDING TRANSITION: The last 1-2 seconds must include smooth fade to black or elegant cross-dissolve after the CTA, NO abrupt cuts\n- End with: balanced exposure, cinematic color grading, no overexposure, rich detail, smooth fade out\n\nExample output:\nCamera slowly dollies forward as the executive turns toward camera and speaks with lips perfectly synced: Welcome to the future of cloud infrastructure. The MSI Technologies logo remains in position. At 5 seconds, the monitor displays: ENTERPRISE SOLUTIONS in ITC Avant Garde with Poppins subtitle: Secure and Scalable in #207CE5. At 10 seconds, executive speaks: Ready to modernize? Contact MSI Technologies. At 12 seconds, screen displays contact@msitechnologiesinc.com in clean white text. Soft fade to black begins at 14 seconds. Cinematic color grading, balanced exposure, photorealistic motion, elegant fade out ending, 16 seconds.\"\n\n: \n\n\"MODE: CREATE NEW VIDEO SCENE\n\nCreate a professional corporate video scene for MSI Technologies.\n\nSCENE REQUIREMENTS:\n- Professional corporate environment (modern office, data center, conference room, or tech workspace)\n- Natural, photorealistic people with realistic movements and expressions\n- When people speak, always specify: lips perfectly synced saying [exact words]\n- Include text on physical surfaces (monitors, wall displays, signage) using MSI brand fonts and colors\n- MSI Technologies logo in bottom right corner throughout\n- Cinematic lighting: soft window light, balanced exposure, professional color grading\n\nMANDATORY CALL TO ACTION (LAST 3-4 SECONDS):\n- Before fade out, include a clear CTA - either spoken by a professional or displayed on screen\n- CTA must include: contact@msitechnologiesinc.com or msitechnologiesinc.com\n- Examples: 'Contact us today', 'Let us transform your infrastructure', 'Schedule your free consultation'\n- Professional executive voice or elegant text overlay\n\nENDING:\n- Smooth fade to black in the last 1-2 seconds after CTA\n- No abrupt cuts, elegant transition\n\nOUTPUT FORMAT:\nDense, descriptive prompt with exact camera movements, dialogue with lip sync specifications, on-screen text details, lighting evolution, CTA moment, and fade out timing. Always specify duration in seconds.\")",
        "options": {
          "systemMessage": "You are a Director of Photography specialized in MSI Technologies corporate video production.\n\n## MSI TECHNOLOGIES CONTEXT\nMSI Technologies is a B2B technology company helping enterprises modernize infrastructure. Services: Cloud Computing, Cybersecurity, AI/ML, DevOps, Digital Transformation. Audience: CTOs, IT Directors, enterprise leaders.\n\nBrand: Professional, senior expert tone. Blue #207CE5, Secondary #004AAD, Accent #FFFDF1.\n\n## YOUR ROLE\nCreate detailed video prompts that:\n1. Establish professional corporate atmosphere\n2. Include realistic people with synced lip movements when speaking\n3. Display text on physical surfaces (screens, walls) - NEVER floating text\n4. Maintain MSI brand colors and logo placement\n5. ALWAYS include a Call to Action before the ending\n6. End with smooth fade to black\n\n## CALL TO ACTION REQUIREMENT (MANDATORY)\nEvery video MUST include a CTA in the last 3-4 seconds before fade out:\n- Spoken by professional: 'Contact MSI Technologies' / 'Ready to modernize? Let's talk'\n- Or displayed on screen: contact@msitechnologiesinc.com / msitechnologiesinc.com\n- Make it natural and professional, not salesy\n\n## ANIMATION RULES\n- Describe camera movements precisely (dolly, pan, crane, push)\n- When people speak, specify: lips synced saying [exact dialogue]\n- Lighting evolution: soft natural light, balanced exposure, cinematic grading\n- Text on physical objects only (monitors, signage, badges)\n- ALWAYS end with smooth fade to black, never abrupt cuts\n\n## LOGO RULES\n- If reference image has logo, respect its position\n- If creating new scene, place logo bottom right\n- NEVER modify, distort, or redesign the MSI logo\n\nOutput dense, descriptive prompts with timing for each element. Always include CTA moment and fade out timing."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        54848,
        3984
      ],
      "id": "c583000c-7bac-4d4b-a2f7-7ed2c8bd622d",
      "name": "Agent: Video Prompt Optimizer"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        54920,
        4208
      ],
      "id": "535f4b45-3da5-47e3-a956-2d89ccdfb8fa",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "oF4jKBK0jRbwEPWt",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "project-id",
              "name": "PROJECT_ID",
              "type": "string",
              "value": "gen-lang-client-0521438560"
            },
            {
              "id": "model-version",
              "name": "MODEL_VERSION",
              "type": "string",
              "value": "veo-3.1-generate-001"
            },
            {
              "id": "location",
              "name": "LOCATION",
              "type": "string",
              "value": "us-central1"
            },
            {
              "id": "api-endpoint",
              "name": "API_ENDPOINT",
              "type": "string",
              "value": "us-central1-aiplatform.googleapis.com"
            },
            {
              "id": "text-prompt",
              "name": "TEXT_PROMPT",
              "type": "string",
              "value": "={{ $('Agent: Video Prompt Optimizer').item.json.output }}. {{ $('Format Video Input').item.json.duration }} second video, {{ $('Format Video Input').item.json.aspect_ratio }} aspect ratio, professional quality."
            },
            {
              "id": "duration",
              "name": "DURATION",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.duration }}"
            },
            {
              "id": "aspect-ratio",
              "name": "ASPECT_RATIO",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.aspect_ratio }}"
            },
            {
              "id": "post-id",
              "name": "POST_ID",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.post_id }}"
            },
            {
              "id": "original-prompt",
              "name": "ORIGINAL_PROMPT",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.prompt }}"
            },
            {
              "id": "logo-url",
              "name": "LOGO_URL",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.logo_url || 'https://i.ibb.co/S7mKXdxr/MSI-Technologies-Icon.png' }}"
            },
            {
              "id": "start-image-url",
              "name": "START_IMAGE_URL",
              "type": "string",
              "value": "={{ $('Format Video Input').item.json.start_image_url }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        55200,
        3984
      ],
      "id": "afed24c1-c87b-42cd-ab16-da8cd79fc954",
      "name": "Settings"
    },
    {
      "parameters": {
        "url": "={{ $('Settings').item.json.LOGO_URL }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        55424,
        3984
      ],
      "id": "e7a9fa03-8c56-418a-9fa6-067082c0781f",
      "name": "Download MSI Logo"
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        55648,
        3984
      ],
      "id": "56ec2a44-a310-4bb3-9e03-0fecf9b3ab70",
      "name": "Logo to Base64"
    },
    {
      "parameters": {
        "jsCode": "// Merge settings with logo base64 data\nconst settings = $('Settings').item.json;\nconst logoData = $input.item.json;\n\n// Check if we have a start image URL\nconst hasStartImage = settings.START_IMAGE_URL && \n                      settings.START_IMAGE_URL !== 'null' && \n                      settings.START_IMAGE_URL !== '' && \n                      settings.START_IMAGE_URL !== 'undefined';\n\nreturn [{\n  json: {\n    PROJECT_ID: settings.PROJECT_ID,\n    MODEL_VERSION: settings.MODEL_VERSION,\n    LOCATION: settings.LOCATION,\n    API_ENDPOINT: settings.API_ENDPOINT,\n    TEXT_PROMPT: settings.TEXT_PROMPT,\n    DURATION: settings.DURATION,\n    ASPECT_RATIO: settings.ASPECT_RATIO,\n    POST_ID: settings.POST_ID,\n    ORIGINAL_PROMPT: settings.ORIGINAL_PROMPT,\n    LOGO_URL: settings.LOGO_URL,\n    START_IMAGE_URL: settings.START_IMAGE_URL,\n    LOGO_BASE64: logoData.data,\n    LOGO_MIME_TYPE: logoData.mimeType || 'image/png',\n    HAS_START_IMAGE: hasStartImage,\n    USE_START_IMAGE_AS_BASE: hasStartImage\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        55872,
        3984
      ],
      "id": "7c52b0dc-8bfc-4d3c-96e0-122e28959e6f",
      "name": "Merge Settings with Logo"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "has-start-image",
              "leftValue": "={{ $json.HAS_START_IMAGE }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        56096,
        3984
      ],
      "id": "5eb9be8c-0ffe-4b1e-ab27-e6f410616993",
      "name": "Check if Start Image"
    },
    {
      "parameters": {
        "url": "={{ $json.START_IMAGE_URL }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        56320,
        3888
      ],
      "id": "0f4c979d-20aa-48aa-9bd0-3beff78eaa44",
      "name": "Download Start Image"
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        56544,
        3888
      ],
      "id": "e88a17fa-e21a-45bb-8043-6aff0c4d6cae",
      "name": "Start Image to Base64"
    },
    {
      "parameters": {
        "jsCode": "// Replace logo data with start image data\nconst settings = $('Merge Settings with Logo').item.json;\nconst startImageData = $input.item.json;\n\nreturn [{\n  json: {\n    PROJECT_ID: settings.PROJECT_ID,\n    MODEL_VERSION: settings.MODEL_VERSION,\n    LOCATION: settings.LOCATION,\n    API_ENDPOINT: settings.API_ENDPOINT,\n    TEXT_PROMPT: settings.TEXT_PROMPT,\n    DURATION: settings.DURATION,\n    ASPECT_RATIO: settings.ASPECT_RATIO,\n    POST_ID: settings.POST_ID,\n    ORIGINAL_PROMPT: settings.ORIGINAL_PROMPT,\n    LOGO_URL: settings.LOGO_URL,\n    LOGO_BASE64: settings.LOGO_BASE64,\n    LOGO_MIME_TYPE: settings.LOGO_MIME_TYPE,\n    START_IMAGE_BASE64: startImageData.data,\n    START_IMAGE_MIME_TYPE: startImageData.mimeType || 'image/jpeg',\n    FINAL_IMAGE_BASE64: startImageData.data,\n    FINAL_IMAGE_MIME_TYPE: startImageData.mimeType || 'image/jpeg'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        56768,
        3888
      ],
      "id": "8c769af7-f3ca-40c8-899a-40be6be9d5ef",
      "name": "Merge Start Image Data"
    },
    {
      "parameters": {
        "jsCode": "// Use logo as base image (no start image provided)\nconst settings = $input.item.json;\n\nreturn [{\n  json: {\n    PROJECT_ID: settings.PROJECT_ID,\n    MODEL_VERSION: settings.MODEL_VERSION,\n    LOCATION: settings.LOCATION,\n    API_ENDPOINT: settings.API_ENDPOINT,\n    TEXT_PROMPT: settings.TEXT_PROMPT,\n    DURATION: settings.DURATION,\n    ASPECT_RATIO: settings.ASPECT_RATIO,\n    POST_ID: settings.POST_ID,\n    ORIGINAL_PROMPT: settings.ORIGINAL_PROMPT,\n    LOGO_URL: settings.LOGO_URL,\n    LOGO_BASE64: settings.LOGO_BASE64,\n    LOGO_MIME_TYPE: settings.LOGO_MIME_TYPE,\n    FINAL_IMAGE_BASE64: settings.LOGO_BASE64,\n    FINAL_IMAGE_MIME_TYPE: settings.LOGO_MIME_TYPE\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        56768,
        4080
      ],
      "id": "36d0f9cf-2d8f-4dce-80c4-22ddee759082",
      "name": "Use Logo as Base"
    },
    {
      "parameters": {
        "jsCode": "// Generate OAuth2 Access Token from Service Account\nconst crypto = require('crypto');\n\n// ========== SERVICE ACCOUNT CREDENTIALS ==========\nconst serviceAccount = {\n  \"type\": \"service_account\",\n  \"project_id\": \"gen-lang-client-0521438560\",\n  \"private_key_id\": \"353528a978e83fdd043e74b03d0096604b3ccd77\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCc8VpJosYd8D0N\\nmFLmh1b7UOsHgm5ZZBvjSkPUhcFXXoEnOoouhWPD5hEl7ziA+3vWpbHLWb5sm0dv\\nqUhHJWwMMbE5eBxmR7m/Cacpy5ZiOVw+180aZqq6e1AsKlEzRvdz66FSgpCeYtmS\\n2nnc8fGwxfB06qpXsxLVQYnwnKzOlKOv9cfXC/29vrbXoPwez9lkVyySa11iGtYA\\nzMU2LjiPrxvcDTbhb1JYD/050fT/m3z2NgclsV6uCEQxNLXOJriJxNuSKhmZufis\\nsoO/rlj/V+RFTrHEQ8zn3nbm6/W2ZANZt94AOo31t5TR6Idt9PxgjodSHJYLEm+0\\nOXC6bAf3AgMBAAECggEASvGn81Ti9YX0qarNH5+OZkmASmA7EL3Q4Wtj07chmfab\\nhx+Zv9hbyT7yfmJrYZB11Qzfx6Lt35AQ/13fkXXp0DLklfRo32Ct7u+Nn1REVlhc\\n1/eWTl6rdYyQPt7gUrO3U+g3655EsBW1Hz7sBZmVmBwVlMdAm8t8GVEILVmr3aN1\\n5CzVUaLtk9UNQDApUfxgdD2kutWTjqM2j3jsgceST6p98dqV2U8HiOXonpMgt02+\\n3PqApJNu4HQhdMzYwX67vKLuqanlZllLlBp8TWvbP3Roo2p57pD8oamT0BKWDUcX\\nfwT19NJOXqRTim6oalvGklTuwhI9+EJJPlAwN7+rAQKBgQDc+sNzQC4Eph4we6g5\\nBQe5QGIchou/ey1vJ+UGbM8vy6bkuy9dPbDZ/XUZTPOYkTPHKvRu544DTIQzH0qJ\\nfG5NKUIYdOInJm8y+r0JybMrrKl0b04/Nrlueb4RjesASMSq3BTVMK5+6Mb4vx7y\\nLS3mYUc8TF+kBEEaw0H4Fwlu9wKBgQC10JcC0kbtCF/MmHwSq9w0PfgbHT3NoZH7\\nyOWeXPfRLybn+I4MMYW3y5KSL5RM3Gxtve2I/HjJPpprZSUJXfMgRLrVkFRV1iFp\\nA/v1vAxoMlYGk3Oh74rwmmMmU7hhPSNL5HxIDHdXVZb5jrOvqIIBcZ6n2qhaCVXH\\nmtjl3QbvAQKBgBxiUWyiV8bdF4+espLwZHeVH4UOezDTP5jBhRd4LnyzKfLDYGgX\\nnnnBpqLjUX7NV9tDVzZPo9wkne57HHXgd8KNhCHkEZB5zVq8/j8dm1gGy5VbHq/b\\n9aGNHa7fjcnxjuFrd3mS0TcX60bUNcNhrj2jTSUfokFNEpe/cN/PBbUtAoGAaSms\\nnyonciT83Gd6pIYZiXIqluxT+iOxP7SU9AOMJ8ehNl2zM+RVFtk9/yZcHhUE9nj7\\n8tctuiFmyiWnxYI9BXYbpzmjPj7r9kUisKFDf+VVktoo8QqQD9kM7ndQV5Y4W0Ze\\niIIFaVONTu22iyzpfZJNlYNJC0MJBbpQKKyuvQECgYEA2q4N8oL3VJwZAuyIVXOm\\ng9SH9dq4pRunQbXJpxaP2mklGNEbLV1YURVGA0oyQE5oh3/4s/LdMERUFkaYBBnl\\nyrcLRELtnjswAy3b2tEp4ULP/rx5MRY4qjNonUrzoXAs937zDIcyjO6/ekxE28sO\\nXk4daXQsjz4PY3lVvJcnKFA=\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\": \"vertex-express@gen-lang-client-0521438560.iam.gserviceaccount.com\",\n  \"client_id\": \"113579530477823292475\",\n  \"token_uri\": \"https://oauth2.googleapis.com/token\"\n};\n\nconst settings = $input.item.json;\n\n// ========== JWT GENERATION ==========\nfunction base64url(str) {\n  return Buffer.from(str).toString('base64')\n    .replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n\nfunction base64urlBuffer(buffer) {\n  return buffer.toString('base64')\n    .replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n\nconst now = Math.floor(Date.now() / 1000);\nconst header = { alg: 'RS256', typ: 'JWT' };\nconst payload = {\n  iss: serviceAccount.client_email,\n  sub: serviceAccount.client_email,\n  aud: serviceAccount.token_uri,\n  iat: now,\n  exp: now + 3600,\n  scope: 'https://www.googleapis.com/auth/cloud-platform'\n};\n\nconst headerB64 = base64url(JSON.stringify(header));\nconst payloadB64 = base64url(JSON.stringify(payload));\nconst signatureInput = `${headerB64}.${payloadB64}`;\n\n// Sign the JWT\nconst privateKey = serviceAccount.private_key;\nconst sign = crypto.createSign('RSA-SHA256');\nsign.update(signatureInput);\nconst signature = sign.sign(privateKey);\nconst signatureB64 = base64urlBuffer(signature);\nconst jwt = `${signatureInput}.${signatureB64}`;\n\n// ========== EXCHANGE JWT FOR ACCESS TOKEN ==========\nconst tokenResponse = await this.helpers.httpRequest({\n  method: 'POST',\n  url: serviceAccount.token_uri,\n  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n  body: `grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=${jwt}`\n});\n\nif (!tokenResponse.access_token) {\n  throw new Error('Failed to get access token: ' + JSON.stringify(tokenResponse));\n}\n\nconsole.log('Access token generated successfully');\n\nreturn [{\n  json: {\n    PROJECT_ID: settings.PROJECT_ID,\n    MODEL_VERSION: settings.MODEL_VERSION,\n    LOCATION: settings.LOCATION,\n    API_ENDPOINT: settings.API_ENDPOINT,\n    TEXT_PROMPT: settings.TEXT_PROMPT,\n    DURATION: settings.DURATION,\n    ASPECT_RATIO: settings.ASPECT_RATIO,\n    POST_ID: settings.POST_ID,\n    ORIGINAL_PROMPT: settings.ORIGINAL_PROMPT,\n    LOGO_URL: settings.LOGO_URL,\n    FINAL_IMAGE_BASE64: settings.FINAL_IMAGE_BASE64,\n    FINAL_IMAGE_MIME_TYPE: settings.FINAL_IMAGE_MIME_TYPE,\n    ACCESS_TOKEN: tokenResponse.access_token\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        56992,
        3984
      ],
      "id": "4587d017-63ac-4013-a178-ffb3daaae916",
      "name": "Generate Access Token"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $json.API_ENDPOINT }}/v1/projects/{{ $json.PROJECT_ID }}/locations/{{ $json.LOCATION }}/publishers/google/models/{{ $json.MODEL_VERSION }}:predictLongRunning",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  instances: [{\n    prompt: $json.TEXT_PROMPT + \", smooth camera movement, cinematic motion, balanced natural lighting, controlled exposure, no overexposure, rich detail, photorealistic, 8k. MSI Technologies logo visible as shown in reference image, maintain exact logo design. Final 1-2 seconds: smooth elegant fade to black transition, no abrupt ending.\",\n    image: {\n      bytesBase64Encoded: $json.FINAL_IMAGE_BASE64,\n      mimeType: $json.FINAL_IMAGE_MIME_TYPE\n    }\n  }],\n  parameters: {\n    aspectRatio: $json.ASPECT_RATIO,\n    sampleCount: 1,\n    durationSeconds: parseInt($json.DURATION),\n    personGeneration: \"allow_all\",\n    addWatermark: false,\n    includeRaiReason: true,\n    generateAudio: true,\n    negativePrompt: \"overexposed, blown highlights, washed out, too bright, static image, no movement, frozen frame, abrupt cut, hard stop, modified logo, distorted logo, different logo design, cartoon, 3d render, animation, bad anatomy, distorted face, low quality, blurry\"\n  }\n}) }}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        57216,
        3984
      ],
      "id": "d146e150-23ec-4d9c-93a5-0282369b6893",
      "name": "Vertex AI - VEO3"
    },
    {
      "parameters": {
        "amount": 2,
        "unit": "minutes"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        57440,
        3984
      ],
      "id": "1c005670-4554-431d-965c-9a9a80dcd867",
      "name": "Wait 2 Minutes",
      "webhookId": "veo3-wait"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Generate Access Token').item.json.API_ENDPOINT }}/v1/projects/{{ $('Generate Access Token').item.json.PROJECT_ID }}/locations/{{ $('Generate Access Token').item.json.LOCATION }}/publishers/google/models/{{ $('Generate Access Token').item.json.MODEL_VERSION }}:fetchPredictOperation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Generate Access Token').item.json.ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"operationName\": \"{{ $('Vertex AI - VEO3').item.json.name }}\"\n}",
        "options": {
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        57664,
        3984
      ],
      "id": "3c1dc6e5-4f02-4307-b577-55b4e5e69609",
      "name": "Vertex AI - Fetch Result"
    },
    {
      "parameters": {
        "jsCode": "// Process Vertex AI response\nconst response = $input.item.json;\nconst settings = $('Generate Access Token').item.json;\nconst formatInput = $('Format Video Input').item.json;\n\nlet videoBase64 = '';\nlet mimeType = 'video/mp4';\n\n// Try different response formats from Veo 3\nif (response.response && response.response.videos && response.response.videos[0] && response.response.videos[0].bytesBase64Encoded) {\n  videoBase64 = response.response.videos[0].bytesBase64Encoded;\n  mimeType = response.response.videos[0].mimeType || 'video/mp4';\n} else if (response.response && response.response.generatedSamples && response.response.generatedSamples[0] && response.response.generatedSamples[0].video) {\n  videoBase64 = response.response.generatedSamples[0].video.bytesBase64Encoded;\n} else if (response.predictions && response.predictions[0] && response.predictions[0].bytesBase64Encoded) {\n  videoBase64 = response.predictions[0].bytesBase64Encoded;\n} else if (response.generatedSamples && response.generatedSamples[0] && response.generatedSamples[0].video) {\n  videoBase64 = response.generatedSamples[0].video.bytesBase64Encoded;\n}\n\nreturn [{\n  json: {\n    video_base64: videoBase64,\n    video_data_url: 'data:' + mimeType + ';base64,' + videoBase64,\n    mime_type: mimeType,\n    has_video: videoBase64.length > 0,\n    is_async: response.done === false,\n    post_id: settings.POST_ID,\n    prompt: settings.TEXT_PROMPT,\n    original_prompt: settings.ORIGINAL_PROMPT,\n    needs_extension: formatInput.needs_extension,\n    extension_seconds: formatInput.extension_seconds,\n    requested_duration: formatInput.requested_duration\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        57888,
        3984
      ],
      "id": "b7f6d88d-44d5-4bf5-9be4-bed243c4ae90",
      "name": "Process Video Response"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "needs-extension-check",
              "leftValue": "={{ $json.needs_extension }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        58112,
        3984
      ],
      "id": "a1b2c3d4-5678-90ab-cdef-123456789abc",
      "name": "Check if Needs Extension"
    },
    {
      "parameters": {
        "jsCode": "// Prepare video extension request\nconst videoData = $input.item.json;\nconst settings = $('Generate Access Token').item.json;\n\nconst extensionPrompt = 'Continue the professional corporate scene naturally. Maintain the same visual style, lighting, and atmosphere. Keep MSI Technologies branding consistent. The scene should flow seamlessly from the previous segment. End with a professional call to action showing contact@msitechnologiesinc.com and an elegant smooth fade to black in the final 2 seconds. Cinematic quality, balanced exposure, photorealistic.';\n\nreturn [{\n  json: {\n    PROJECT_ID: settings.PROJECT_ID,\n    MODEL_VERSION: settings.MODEL_VERSION,\n    LOCATION: settings.LOCATION,\n    API_ENDPOINT: settings.API_ENDPOINT,\n    ACCESS_TOKEN: settings.ACCESS_TOKEN,\n    ASPECT_RATIO: settings.ASPECT_RATIO,\n    TEXT_PROMPT: settings.TEXT_PROMPT,\n    BASE_VIDEO_B64: videoData.video_base64,\n    BASE_VIDEO_MIME: videoData.mime_type || 'video/mp4',\n    EXTENSION_SECONDS: videoData.extension_seconds,\n    PROMPT_EXTENSION: extensionPrompt,\n    POST_ID: videoData.post_id,\n    ORIGINAL_PROMPT: videoData.original_prompt,\n    REQUESTED_DURATION: videoData.requested_duration\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        58336,
        3888
      ],
      "id": "b2c3d4e5-6789-01bc-def0-234567890bcd",
      "name": "Prepare Extension Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $json.API_ENDPOINT }}/v1/projects/{{ $json.PROJECT_ID }}/locations/{{ $json.LOCATION }}/publishers/google/models/{{ $json.MODEL_VERSION }}:predictLongRunning",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  instances: [{\n    prompt: $json.PROMPT_EXTENSION,\n    video: {\n      bytesBase64Encoded: $json.BASE_VIDEO_B64,\n      mimeType: $json.BASE_VIDEO_MIME\n    }\n  }],\n  parameters: {\n    aspectRatio: $json.ASPECT_RATIO,\n    sampleCount: 1,\n    durationSeconds: parseInt($json.EXTENSION_SECONDS),\n    addWatermark: false,\n    includeRaiReason: true,\n    generateAudio: true,\n    negativePrompt: \"abrupt cut, hard stop, overexposed, washed out, static, frozen, different style, inconsistent lighting\"\n  }\n}) }}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        58560,
        3888
      ],
      "id": "c3d4e5f6-7890-12cd-ef01-345678901cde",
      "name": "Vertex AI - Extend Video"
    },
    {
      "parameters": {
        "amount": 2,
        "unit": "minutes"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        58784,
        3888
      ],
      "id": "d4e5f6a7-8901-23de-f012-456789012def",
      "name": "Wait for Extension",
      "webhookId": "veo3-extend-wait"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Prepare Extension Request').item.json.API_ENDPOINT }}/v1/projects/{{ $('Prepare Extension Request').item.json.PROJECT_ID }}/locations/{{ $('Prepare Extension Request').item.json.LOCATION }}/publishers/google/models/{{ $('Prepare Extension Request').item.json.MODEL_VERSION }}:fetchPredictOperation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Prepare Extension Request').item.json.ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"operationName\": \"{{ $('Vertex AI - Extend Video').item.json.name }}\"\n}",
        "options": {
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        59008,
        3888
      ],
      "id": "e5f6a7b8-9012-34ef-0123-567890123ef0",
      "name": "Fetch Extended Video"
    },
    {
      "parameters": {
        "jsCode": "// Process extended video response\nconst response = $input.item.json;\nconst settings = $('Prepare Extension Request').item.json;\n\nlet videoBase64 = '';\nlet mimeType = 'video/mp4';\n\n// Try different response formats\nif (response.response && response.response.videos && response.response.videos[0] && response.response.videos[0].bytesBase64Encoded) {\n  videoBase64 = response.response.videos[0].bytesBase64Encoded;\n  mimeType = response.response.videos[0].mimeType || 'video/mp4';\n} else if (response.response && response.response.generatedSamples && response.response.generatedSamples[0] && response.response.generatedSamples[0].video) {\n  videoBase64 = response.response.generatedSamples[0].video.bytesBase64Encoded;\n} else if (response.predictions && response.predictions[0] && response.predictions[0].bytesBase64Encoded) {\n  videoBase64 = response.predictions[0].bytesBase64Encoded;\n} else if (response.generatedSamples && response.generatedSamples[0] && response.generatedSamples[0].video) {\n  videoBase64 = response.generatedSamples[0].video.bytesBase64Encoded;\n}\n\nreturn [{\n  json: {\n    video_base64: videoBase64,\n    video_data_url: 'data:' + mimeType + ';base64,' + videoBase64,\n    mime_type: mimeType,\n    has_video: videoBase64.length > 0,\n    post_id: settings.POST_ID,\n    prompt: settings.TEXT_PROMPT,\n    original_prompt: settings.ORIGINAL_PROMPT,\n    final_duration: settings.REQUESTED_DURATION\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        59232,
        3888
      ],
      "id": "f6a7b8c9-0123-45f0-1234-678901234f01",
      "name": "Process Extended Video"
    },
    {
      "parameters": {
        "jsCode": "// Convert base64 video to binary for YouTube upload\nconst videoBase64 = $json.video_base64;\nconst prompt = $json.original_prompt || $json.prompt || 'MSI Content';\nconst postId = $json.post_id;\nconst mimeType = $json.mime_type || 'video/mp4';\n\nif (!videoBase64) {\n  throw new Error('No video base64 data available');\n}\n\nconst binaryData = Buffer.from(videoBase64, 'base64');\nlet title = prompt.substring(0, 97);\nif (prompt.length > 97) title += '...';\nconst fileName = `msi_video_${Date.now()}.mp4`;\n\nreturn {\n  json: {\n    title,\n    description: `Generated with AI by MSI Technologies\\n\\nPrompt: ${prompt}\\n\\nPost ID: ${postId || 'N/A'}`,\n    post_id: postId,\n    original_prompt: prompt\n  },\n  binary: {\n    data: {\n      data: binaryData.toString('base64'),\n      mimeType: mimeType,\n      fileName: fileName\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        59456,
        4080
      ],
      "id": "b20c704d-31a1-44d8-8604-928796857331",
      "name": "Prepare YouTube Upload"
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "upload",
        "title": "={{ $json.title }}",
        "categoryId": "28",
        "options": {
          "description": "={{ $json.description }}",
          "privacyStatus": "unlisted",
          "tags": "ai,content,msi,technology"
        }
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        59680,
        4080
      ],
      "id": "d4ce1245-6a71-451d-9cfe-04aa52f2b9a1",
      "name": "Upload to YouTube",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "Mku9dCuHHXi7CGsE",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $input.item.json;\nconst preparedData = $('Prepare YouTube Upload').item.json;\n\nconst videoId = response.id || response.uploadId;\nconst youtubeUrl = `https://youtu.be/${videoId}`;\n\nreturn [{\n  json: {\n    youtube_url: youtubeUrl,\n    youtube_video_id: videoId,\n    post_id: preparedData.post_id,\n    title: preparedData.title,\n    prompt: preparedData.original_prompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        59904,
        4080
      ],
      "id": "199e7456-8736-4a5b-9f75-f1a6e58541c5",
      "name": "Extract YouTube URL"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ $json.post_id && $json.post_id.length > 10 ? `UPDATE social_posts SET youtube_url = '${$json.youtube_url}', status = 'video_completed', updated_at = NOW() WHERE id = '${$json.post_id}' RETURNING *` : `SELECT '${$json.youtube_url}' as youtube_url, 'no_post_id' as status` }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        60128,
        4080
      ],
      "id": "22d68c5a-db47-482e-b22b-ac6be9671832",
      "name": "Update DB with YouTube",
      "credentials": {
        "postgres": {
          "id": "WnTYs2zvPoE7hDJE",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, message: 'Video uploaded to YouTube successfully', data: { youtube_url: $json.youtube_url, youtube_video_id: $json.youtube_video_id, post_id: $json.post_id, prompt: $json.prompt } }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        60352,
        4080
      ],
      "id": "690a9620-96e9-4fc1-9e3b-30b4ac368543",
      "name": "Respond Success"
    }
  ],
  "connections": {
    "Webhook - Video Gen": {
      "main": [
        [
          {
            "node": "Format Video Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Video Input": {
      "main": [
        [
          {
            "node": "Agent: Video Prompt Optimizer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Video Prompt Optimizer": {
      "main": [
        [
          {
            "node": "Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agent: Video Prompt Optimizer",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Settings": {
      "main": [
        [
          {
            "node": "Download MSI Logo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download MSI Logo": {
      "main": [
        [
          {
            "node": "Logo to Base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logo to Base64": {
      "main": [
        [
          {
            "node": "Merge Settings with Logo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Settings with Logo": {
      "main": [
        [
          {
            "node": "Check if Start Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Start Image": {
      "main": [
        [
          {
            "node": "Download Start Image",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Use Logo as Base",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Start Image": {
      "main": [
        [
          {
            "node": "Start Image to Base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start Image to Base64": {
      "main": [
        [
          {
            "node": "Merge Start Image Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Start Image Data": {
      "main": [
        [
          {
            "node": "Generate Access Token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Logo as Base": {
      "main": [
        [
          {
            "node": "Generate Access Token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Access Token": {
      "main": [
        [
          {
            "node": "Vertex AI - VEO3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vertex AI - VEO3": {
      "main": [
        [
          {
            "node": "Wait 2 Minutes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 2 Minutes": {
      "main": [
        [
          {
            "node": "Vertex AI - Fetch Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vertex AI - Fetch Result": {
      "main": [
        [
          {
            "node": "Process Video Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Video Response": {
      "main": [
        [
          {
            "node": "Check if Needs Extension",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Needs Extension": {
      "main": [
        [
          {
            "node": "Prepare Extension Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare YouTube Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Extension Request": {
      "main": [
        [
          {
            "node": "Vertex AI - Extend Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vertex AI - Extend Video": {
      "main": [
        [
          {
            "node": "Wait for Extension",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Extension": {
      "main": [
        [
          {
            "node": "Fetch Extended Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Extended Video": {
      "main": [
        [
          {
            "node": "Process Extended Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Extended Video": {
      "main": [
        [
          {
            "node": "Prepare YouTube Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare YouTube Upload": {
      "main": [
        [
          {
            "node": "Upload to YouTube",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to YouTube": {
      "main": [
        [
          {
            "node": "Extract YouTube URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract YouTube URL": {
      "main": [
        [
          {
            "node": "Update DB with YouTube",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DB with YouTube": {
      "main": [
        [
          {
            "node": "Respond Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b5116c87255060ddf18db8a2b1b90e34b38f50f44815cf784a0b8a92b6bb4e6e"
  }
}