  {
    "name": "MSI Carousel Gen Flow v16",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "msi-carousel-v12",
          "responseMode": "lastNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          0,
          0
        ],
        "id": "webhook",
        "name": "Webhook - Carousel Gen"
      },
      {
        "parameters": {
          "jsCode": "// Format Input & Parse News\nconst input = $('Webhook - Carousel Gen').item.json;\nlet data = input.body || input;\nif (typeof data === 'string') {\n  try { data = JSON.parse(data); } catch(e) { data = input; }\n}\n\n// Handle news content specifically if present\nconst newsItems = data.news_items || [];\n// If individual fields are passed instead of array\nif (newsItems.length === 0 && (data.news_title || data.news_content)) {\n    newsItems.push({\n        title: data.news_title,\n        content: data.news_content,\n        source: data.news_source\n    });\n}\n\n// Extract rich content\nconst news1 = newsItems[0] || {};\nconst news2 = newsItems[1] || {};\nconst news3 = newsItems[2] || {};\n\nconst getContent = function(n) {\n  return (n.content || n.snippet || n.description || '').substring(0, 500);\n};\n\nreturn [{\n  json: {\n    // Original fields\n    topic: data.topic || news1.title || 'Tech Trends',\n    visual_style: 'Realistic Photography', // FORCE Realistic Photography\n    headline: data.headline || news1.title || '',\n    \n    // News Parsing\n    news_count: newsItems.length,\n    n1_title: news1.title || '',\n    n1_source: news1.source || '',\n    n1_content: getContent(news1),\n    n2_title: news2.title || '',\n    n2_source: news2.source || '',\n    n2_content: getContent(news2),\n    n3_title: news3.title || '',\n    n3_source: news3.source || '',\n    n3_content: getContent(news3),\n    \n    color_primary: data.color_primary || '#207CE5',\n    color_secondary: data.color_secondary || '#004AAD'\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          220,
          0
        ],
        "id": "format-input",
        "name": "Format Input"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=READ THESE 3 NEWS STORIES CAREFULLY:\n\nNEWS 1: {{ $json.n1_title }}\nSource: {{ $json.n1_source }}\nContent: {{ $json.n1_content }}\n\nNEWS 2: {{ $json.n2_title }}\nSource: {{ $json.n2_source }}\nContent: {{ $json.n2_content }}\n\nNEWS 3: {{ $json.n3_title }}\nSource: {{ $json.n3_source }}\nContent: {{ $json.n3_content }}\n\nTOPIC: {{ $json.topic }}\n\nTASK - STRATEGIC ANALYSIS:\n\n1. Find the STRATEGIC THREAD connecting these 3 stories. Not just 'they're all about tech' - find the deeper business implication. What real shift do these stories reveal together?\n\n2. Write a COVER HOOK that frames the carousel as a STRATEGIC BRIEFING for business leaders. The hook should name the real shift or disruption, not just the topic.\n   - BAD: 'Big Tech Updates This Week' (generic, no insight)\n   - BAD: 'Three Companies Made Big Moves' (surface-level)\n   - GOOD: 'AI Is Reshaping Revenue Models Faster Than Expected' (names the shift, implies urgency)\n   - GOOD: 'The Cloud Price War Just Changed Who Wins' (specific disruption, stakes)\n   - GOOD: 'Trust Is Becoming Tech's Most Valuable Currency' (strategic angle, thought leadership)\n\n3. For EACH story, extract the STRATEGIC INSIGHT using this 4-part framework:\n   a) HOOK: The most provocative data point or angle from the article (something that challenges assumptions)\n   b) WHAT HAPPENED: Ultra-brief factual summary (1 sentence)\n   c) WHY IT MATTERS: Real impact on business, industry, or competitive landscape\n   d) STRATEGIC IMPLICATION: What this means for how companies should think about their strategy\n   Use ONLY facts from the article. NEVER invent data. But DO interpret the business implications.\n\n4. For each story, describe a SPECIFIC VISUAL SCENE that represents the STRATEGIC ANGLE (not just the topic). The image should convey the business impact, not just 'tech stuff'.\n   - BAD: 'a modern office' (generic)\n   - GOOD for AI revenue story: 'close-up of a financial dashboard showing revenue curves trending upward on a sleek monitor, dramatic side lighting, editorial photography'\n   - GOOD for trust/security story: 'a corporate boardroom viewed through glass walls, empty chairs around a long table with documents, moody atmospheric lighting'\n\n5. Suggest a CTA for Slide 5.\n\nCRITICAL:\n- ONLY facts from the articles. NOTHING invented.\n- But DO interpret business implications - that's the value MSI adds.\n- Write for business leaders and decision-makers, not casual readers.\n- Simple, clear language - but with SUBSTANCE and STRATEGIC DEPTH.\n- NO acronyms. NO jargon.\n\nOUTPUT:\n- Theme: [Strategic thread - the real shift these stories reveal]\n- Hook: [Strategic cover headline that positions MSI as a thought leader]\n- Insight 1: { hook, what_happened, why_it_matters, strategic_implication }\n- Scene 1: [Specific visual scene reflecting the strategic angle of news 1]\n- Insight 2: { hook, what_happened, why_it_matters, strategic_implication }\n- Scene 2: [Specific visual scene reflecting the strategic angle of news 2]\n- Insight 3: { hook, what_happened, why_it_matters, strategic_implication }\n- Scene 3: [Specific visual scene reflecting the strategic angle of news 3]\n- CTA: [Call to Action]",
          "options": {
            "systemMessage": "# ROLE: Strategic Tech Analyst for Instagram\nYou are MSI Technologies' strategic analyst. You turn raw tech news into EXECUTIVE-LEVEL INSIGHTS packaged for Instagram carousels.\n\nGOLDEN RULE: ONLY use facts from the original articles. NEVER invent data, dates, or numbers. BUT you DO interpret what those facts MEAN for business strategy - that's the value you add.\n\nYOUR SUPERPOWER: You see what others miss. You don't just report WHAT happened - you explain WHY it matters for business leaders and WHAT it signals about where the industry is heading. You turn news into strategic intelligence.\n\nHOOK FORMULA: Name the REAL SHIFT or DISRUPTION, not just the topic.\n- BAD: 'Big Tech Updates' / 'Three News Stories' / 'Tech Industry Changes' (generic, no insight)\n- GOOD: 'AI Is Reshaping Revenue Models Faster Than Expected' (names the shift, creates urgency)\n- GOOD: 'The Cloud Price War Just Changed Who Wins' (specific disruption with stakes)\n- GOOD: 'Trust Is Becoming Tech's Most Valuable Currency' (strategic angle, thought leadership)\n\nAUDIENCE: Business leaders, CTOs, decision-makers who need to understand what tech news means for THEIR strategy.\nLANGUAGE: Clear, direct, intelligent but accessible. NO acronyms. NO jargon. Think McKinsey meets Instagram."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          440,
          0
        ],
        "id": "agent-strategy",
        "name": "Agent 1: Strategy Analyst"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=STRATEGIC ANALYSIS FROM AGENT 1 (includes insights and scene descriptions):\n{{ $('Agent 1: Strategy Analyst').item.json.output }}\n\nORIGINAL NEWS (FACTS SOURCE - DO NOT INVENT):\nNews 1: {{ $('Format Input').item.json.n1_title }}\nSource: {{ $('Format Input').item.json.n1_source }}\nContent: {{ $('Format Input').item.json.n1_content }}\n\nNews 2: {{ $('Format Input').item.json.n2_title }}\nSource: {{ $('Format Input').item.json.n2_source }}\nContent: {{ $('Format Input').item.json.n2_content }}\n\nNews 3: {{ $('Format Input').item.json.n3_title }}\nSource: {{ $('Format Input').item.json.n3_source }}\nContent: {{ $('Format Input').item.json.n3_content }}\n\nTASK:\nCreate a 5-slide Instagram Carousel (4:5 format) that positions MSI Technologies as a STRATEGIC THOUGHT LEADER.\nALL OUTPUT IN ENGLISH.\nThis is NOT a generic news digest. Each slide must deliver a MICRO-INSIGHT that makes business leaders think 'I need to follow this account'.\n\nGOLDEN RULE: Use facts from the articles. NEVER invent data. But DO interpret strategic implications - that's the value.\n\nSLIDE 1 (COVER):\n- Headline: STRATEGIC HOOK (5-10 words). Name the REAL SHIFT happening, not just the topic. The headline alone should make a CTO or business leader stop scrolling.\n  - BAD: 'Tech Industry News Update' / 'Three Big Stories' (generic, zero value)\n  - BAD: 'Companies Are Making Big Moves' (vague, could be anything)\n  - GOOD: 'AI Is Reshaping Revenue Models Faster Than Expected' (names the shift, implies urgency)\n  - GOOD: 'The Trust Economy Is Replacing The Data Economy' (provocative strategic angle)\n  - GOOD: 'Three Signals That Cloud Strategy Must Change Now' (specific, actionable framing)\n- Subtext: LEAVE EMPTY.\n- Body: LEAVE EMPTY.\n\nSLIDE 2-4 (STRATEGIC NEWS INSIGHTS - 4-PART STRUCTURE):\n\nEach slide MUST follow this exact 4-part body structure (3-4 lines total):\n\n1. HOOK LINE: Open with the most provocative angle or data point from the story. Challenge assumptions. (1 sentence)\n2. WHAT HAPPENED: Ultra-brief factual core of the story. (1 sentence)\n3. WHY IT MATTERS: The real business impact - what this means for the industry, competitive landscape, or strategy. (1 sentence)\n4. STRATEGIC TAKEAWAY: The deeper implication - how smart companies should think about this. (1 sentence)\n\nEXAMPLE (for an IBM AI news story):\nHeadline: 'AI Is Reshaping Revenue Models Faster Than Expected'\nBody: 'AI is enabling entirely new ways to make money. But the real shift is not the technology itself - it is trust, governance, and data control. Companies that do not build AI with security and transparency at the core will lose credibility. The competitive advantage will be how responsibly and strategically companies deploy AI.'\n\nNOTICE:\n- The headline names the SHIFT, not just the company or event\n- Line 1 (Hook): provocative opening angle\n- Line 2 (What): brief fact\n- Line 3 (Why): business impact\n- Line 4 (Takeaway): strategic conclusion that positions MSI's expertise\n\nHEADLINE RULES:\n- Name the DISRUPTION or SHIFT, not just the event. Present tense.\n  - BAD: 'IBM Launches New AI Tool' (descriptive, boring)\n  - GOOD: 'AI Is Reshaping Revenue Models Faster Than Expected' (names the shift)\n  - BAD: 'Google Partners With Samsung' (just facts, no angle)\n  - GOOD: 'This Partnership Redefines Who Controls Your Data' (strategic angle)\n- NO colons. NO semicolons. NO acronyms.\n\nBODY RULES:\n- 3-4 lines MAXIMUM following the 4-part structure above\n- Each line delivers DISTINCT value (hook, fact, impact, takeaway)\n- Simple, clear English - but with SUBSTANCE and DEPTH\n- The reader should feel SMARTER after reading\n- Write for business leaders, not casual browsers\n\nFORBIDDEN in body: acronyms, jargon, invented data, invented dates, generic statements that could apply to any news\n\n- Source: EXACT source name. Default: 'Industry Report'.\n\nSLIDE 5 (CTA):\n- Headline: Strategic question. 'Need A Technology Partner?' / 'Ready To Lead The Shift?' / 'Want Strategic Tech Insights?'\n- Subtext: 'Let's Build Your Strategy' / 'Partner With Us' / 'Let's Work Together'\n- Body: LEAVE EMPTY\n- Contact: \"contact@msitechnologiesinc.com | msitechnologiesinc.com\"\n\nOUTPUT JSON ARRAY:\n[\n  {\n    \"slide_number\": 1,\n    \"headline\": \"...\",\n    \"subtext\": \"\",\n    \"body\": \"\"\n  },\n  {\n    \"slide_number\": 2,\n    \"headline\": \"...\",\n    \"body\": \"...\",\n    \"source\": \"...\"\n  },\n  ... (5 slides total)\n]",
          "options": {
            "systemMessage": "# ROLE: Strategic Tech Content Writer for Instagram\nYou write STRATEGIC INSIGHTS disguised as Instagram carousel content for MSI Technologies. Your posts get saved and shared because they make business leaders THINK and feel smarter.\n\nGOLDEN RULE: Facts from the source ONLY. NEVER invent data. But you DO interpret business implications - that is your value.\n\nHEADLINE PHILOSOPHY:\n- Headlines name the SHIFT or DISRUPTION, not just the event. They frame the news through a strategic lens.\n- BAD: 'IBM Launches New AI Tool' (descriptive, no insight, generic)\n- BAD: 'Company Makes Smart Move' (vague, says nothing)\n- GOOD: 'AI Is Reshaping Revenue Models Faster Than Expected' (names the shift, strategic angle)\n- GOOD: 'This Partnership Redefines Who Controls Your Data' (provocative, stakes-driven)\n\nBODY TEXT PHILOSOPHY (4-PART STRUCTURE - MANDATORY):\nEvery news slide body MUST follow this structure in 3-4 lines:\n1. HOOK: Provocative opening angle or data point\n2. WHAT HAPPENED: Ultra-brief factual summary\n3. WHY IT MATTERS: Real business/industry impact\n4. STRATEGIC TAKEAWAY: Deeper implication for company strategy\n\nThe reader should feel SMARTER and get a STRATEGIC TAKEAWAY they can use.\n\nSTYLE:\n- Clear, direct, intelligent. Think 'strategic advisor' not 'news anchor'.\n- Headlines in PRESENT TENSE. Body in PRESENT/PAST TENSE as fits naturally.\n- Simple words but SUBSTANTIVE content. Accessible to anyone but valuable to executives.\n- Keep brand/product names. Simplify technical concepts.\n\nFORBIDDEN:\n- Invented data (dates, numbers, quotes not in source)\n- Time references unless source says them\n- Acronyms - spell out or rephrase\n- Jargon\n- Buzzwords ('game-changing', 'revolutionary', 'cutting-edge', 'disruptive')\n- Generic statements that could apply to ANY news story\n- Surface-level descriptions without strategic depth"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          760,
          0
        ],
        "id": "agent-copywriter",
        "name": "Agent 2: Copywriter"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=SLIDES FROM COPYWRITER (read headline + body carefully):\\n{{ $('Agent 2: Copywriter').item.json.output }}\\n\\nSCENE DESCRIPTIONS FROM STRATEGY (use as starting point):\\n{{ $('Agent 1: Strategy Analyst').item.json.output }}\\n\\nTASK:\\nFor EACH slide, create an 'image_prompt' that visually represents the STRATEGIC ANGLE of that slide - not just the topic, but the INSIGHT.\\n\\nIMPORTANT:\\n- Add ONLY the 'image_prompt' field to each existing slide object\\n- Do NOT modify existing fields\\n- Return the EXACT same JSON structure with added image_prompt fields\\n\\nMSI BRAND GUIDELINES:\\n- COLORS: MSI Blue (#207CE5), Dark Blue (#004AAD), Cream (#FFFDF1)\\n- TYPOGRAPHY: ITC Avant Garde (headlines), Poppins (subheadings), Quicksand (body)\\n- LAYOUT: Split layout with 55% image top, 45% text bottom\\n\\nIMAGE PROMPT PHILOSOPHY:\\nThe image must visually communicate the STRATEGIC ANGLE of the headline, not just the news topic.\\n\\nRead BOTH the headline AND the body text. The image should match the INSIGHT, not just the subject.\\n\\nEXAMPLES:\\n- Headline: 'AI Is Reshaping Revenue Models Faster Than Expected'\\n  BAD: 'a robot or AI visualization' (illustrates topic, not insight)\\n  GOOD: 'close-up of a financial dashboard on a large monitor showing multiple ascending revenue curves and data streams, dramatic side lighting through venetian blinds, cinematic editorial photography'\\n  WHY: The insight is about REVENUE MODELS, so the image shows financial data, not AI imagery\\n\\n- Headline: 'This Partnership Redefines Who Controls Your Data'\\n  BAD: 'two people shaking hands' (cliché, generic)\\n  GOOD: 'a massive corporate data center corridor stretching into the distance, rows of illuminated server cabinets with blue LED indicators, symmetrical composition, architectural photography'\\n  WHY: The insight is about DATA CONTROL, so the image shows the physical infrastructure where data lives\\n\\n- Headline: 'Trust Is Becoming Tech's Most Valuable Currency'\\n  BAD: 'a lock or shield icon' (cliché)\\n  GOOD: 'a glass-walled corporate boardroom at dusk with city skyline visible, empty executive chairs around an oak table with closed laptops, atmospheric low-key lighting'\\n  WHY: The insight is about TRUST in business decisions, so show where those decisions happen\\n\\nRULES:\\n- Be EXTREMELY SPECIFIC: describe exact setting, objects, lighting, angle, mood, photography style\\n- Each image MUST be visually different from the others (vary setting, angle, lighting, mood)\\n- REALISTIC PHOTOGRAPHY ONLY: editorial, documentary, architectural, or product photography\\n\\nFORBIDDEN:\\n- Generic descriptions ('modern office', 'technology workspace', 'business environment')\\n- Surrealism, abstract art, floating objects, sci-fi, neon, digital particles\\n- Clichés: handshakes, people pointing at screens, lightbulbs, puzzle pieces\\n- People unless absolutely essential\\n- Any image that could apply to ANY tech news\\n\\nReturn valid JSON.",
          "options": {
            "systemMessage": "# ROLE: Strategic Visual Director (Instagram Photo Director)\nYou create image descriptions that visually communicate the STRATEGIC INSIGHT of each slide, not just the topic.\n\nIMAGE PHILOSOPHY:\n- Read the headline AND body of each slide. The image represents the INSIGHT/ANGLE, not just the subject.\n- If the headline says 'AI Is Reshaping Revenue Models' - show REVENUE (financial dashboards, data), not AI (robots, circuits).\n- If the headline says 'Trust Is The New Currency' - show TRUST environments (boardrooms, governance), not technology.\n- Think: what would a Bloomberg or Harvard Business Review photo editor choose for this headline?\n- REALISTIC PHOTOGRAPHY ONLY: editorial, documentary, architectural, product, or cinematic photography.\n- Be EXTREMELY SPECIFIC: exact setting, objects, lighting direction, camera angle, mood, photography style.\n\nFORBIDDEN:\n- Generic descriptions ('modern office', 'technology workspace', 'business environment')\n- Surrealism, abstract art, floating objects, sci-fi, neon, digital particles\n- Clichés: handshakes, people pointing at screens, lightbulbs, puzzle pieces, smiling people in suits\n- Stock photo vibes\n- Images that could apply to ANY tech news (must be specific to THIS slide's insight)\n\nDESIGN RULES:\n- NO TEXT SHADOWS. FLAT DESIGN.\n- SMALLER FONT for body text to guarantee 3-4 lines.\n- Slide Indicator: REGULAR weight (NOT BOLD).\n- Slide 1: eye-catching but CLEAN.\n- Slides 2-4: 55% image top, 45% text bottom. Body text up to 4 short lines.\n\nERROR HANDLING:\n- Always expect a JSON array input\n- If input is not valid JSON, return error message\n- If slides are missing required fields, use defaults\n- Always return valid JSON structure"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1080,
          0
        ],
        "id": "agent-visual",
        "name": "Agent 3: Visual Director"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "chatgpt-4o-latest",
            "mode": "list",
            "cachedResultName": "chatgpt-4o-latest"
          },
          "builtInTools": {},
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          860,
          -240
        ],
        "id": "openai-model",
        "name": "OpenAI Model",
        "credentials": {
          "openAiApi": {
            "id": "13Oqly3WdRAzZVXL",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse Final JSON Output\nconst rawOutput = $('Agent 3: Visual Director').item.json.output;\nconst cleanedOutput = rawOutput.replace(/```json/g, '').replace(/```/g, '').trim();\nconst generated = JSON.parse(cleanedOutput);\nconst originalInput = $('Format Input').item.json;\n\n// Add metadata to each slide\nconst slides = generated.map(slide => ({\n    ...slide,\n    visual_style: originalInput.visual_style,\n    carousel_id: null\n}));\n\nreturn [{\n    json: {\n        slides: slides,\n        parent_post: {\n            topic: originalInput.topic,\n            headline: slides[0].headline,\n            visual_style: originalInput.visual_style,\n            post_type: 'Carousel',\n            status: 'generating_images'\n        }\n    }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1340,
          0
        ],
        "id": "parse-output",
        "name": "Parse Output"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "=INSERT INTO social_posts (topic, post_type, visual_style, orientation, headline, status, created_at)\nVALUES ('{{ $json.parent_post.topic.replace(/'/g, \"''\") }}', 'Carousel', '{{ $json.parent_post.visual_style }}', '4:5', '{{ $json.parent_post.headline.replace(/'/g, \"''\") }}', 'generating', NOW())\nRETURNING id",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1560,
          0
        ],
        "id": "create-post",
        "name": "Create Post Record",
        "credentials": {
          "postgres": {
            "id": "WnTYs2zvPoE7hDJE",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Prepare All Slides Data\nconst postId = $('Create Post Record').item.json.id;\nconst slides = $('Parse Output').item.json.slides;\nconst topic = $('Format Input').item.json.topic || 'Technology';\n\n// Return all slides as individual items for batch insert\n// Embed topic inside visual_style JSON since carousel_slides table doesn't have topic column\nconst slideItems = slides.map(slide => ({\n    json: {\n        carousel_id: postId,\n        slide_number: slide.slide_number,\n        headline: slide.headline,\n        subtext: slide.subtext || '',\n        body_text: slide.body || slide.body_text || '',\n        image_prompt: slide.image_prompt,\n        visual_style: JSON.stringify({ style: slide.visual_style, source: slide.source || '', topic: topic })\n    }\n}));\n\nreturn slideItems;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1700,
          0
        ],
        "id": "prepare-slides",
        "name": "Prepare Slides"
      },
      {
        "parameters": {
          "operation": "insert",
          "schema": {
            "__rl": true,
            "value": "public",
            "mode": "list",
            "cachedResultName": "public"
          },
          "table": {
            "__rl": true,
            "value": "carousel_slides",
            "mode": "list",
            "cachedResultName": "carousel_slides"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "carousel_id",
                "displayName": "carousel_id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "slide_number",
                "displayName": "slide_number",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "integer",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "headline",
                "displayName": "headline",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "subtext",
                "displayName": "subtext",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "body_text",
                "displayName": "body_text",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "image_prompt",
                "displayName": "image_prompt",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ]
          },
          "options": {
            "returnFields": "*"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1850,
          0
        ],
        "id": "insert-slides",
        "name": "Insert Slides",
        "credentials": {
          "postgres": {
            "id": "WnTYs2zvPoE7hDJE",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Get all inserted slides and prepare for sequential processing\nconst allInserted = $input.all().map(item => item.json);\n\n// Extract topic from visual_style JSON\nlet topic = 'Technology';\ntry {\n  const vsData = JSON.parse(allInserted[0].visual_style || '{}');\n  topic = vsData.topic || 'Technology';\n} catch(e) {}\n\n// Store all slides data for the chain\nconst s1 = allInserted[0];\nconst s2 = allInserted[1];\nconst s3 = allInserted[2];\nconst s4 = allInserted[3];\nconst s5 = allInserted[4];\n\nreturn [{\n  json: {\n    // Current slide to process\n    id: s1.id,\n    carousel_id: s1.carousel_id,\n    slide_number: s1.slide_number,\n    headline: s1.headline || '',\n    subtext: s1.subtext || '',\n    body_text: s1.body_text || '',\n    image_prompt: s1.image_prompt || '',\n    visual_style: s1.visual_style || '',\n    topic: topic,\n    // All slides for the chain\n    s2_id: s2.id, s2_headline: s2.headline || '', s2_subtext: s2.subtext || '', s2_body: s2.body_text || '', s2_prompt: s2.image_prompt || '', s2_style: s2.visual_style || '',\n    s3_id: s3.id, s3_headline: s3.headline || '', s3_subtext: s3.subtext || '', s3_body: s3.body_text || '', s3_prompt: s3.image_prompt || '', s3_style: s3.visual_style || '',\n    s4_id: s4.id, s4_headline: s4.headline || '', s4_subtext: s4.subtext || '', s4_body: s4.body_text || '', s4_prompt: s4.image_prompt || '', s4_style: s4.visual_style || '',\n    s5_id: s5.id, s5_headline: s5.headline || '', s5_subtext: s5.subtext || '', s5_body: s5.body_text || '', s5_prompt: s5.image_prompt || '', s5_style: s5.visual_style || '',\n    carousel_id_shared: s1.carousel_id\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2050,
          -100
        ],
        "id": "get-slide-1",
        "name": "Get Slide 1"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2200,
          -100
        ],
        "id": "gen-slide-1",
        "name": "Gen Slide 1"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s2_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 2,\n    headline: prev.s2_headline,\n    subtext: prev.s2_subtext,\n    body_text: prev.s2_body,\n    image_prompt: prev.s2_prompt,\n    visual_style: prev.s2_style,\n    topic: prev.topic,\n    // Pass remaining slides\n    s3_id: prev.s3_id, s3_headline: prev.s3_headline, s3_subtext: prev.s3_subtext, s3_body: prev.s3_body, s3_prompt: prev.s3_prompt, s3_style: prev.s3_style,\n    s4_id: prev.s4_id, s4_headline: prev.s4_headline, s4_subtext: prev.s4_subtext, s4_body: prev.s4_body, s4_prompt: prev.s4_prompt, s4_style: prev.s4_style,\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2500,
          -100
        ],
        "id": "get-slide-2",
        "name": "Get Slide 2"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2650,
          -100
        ],
        "id": "gen-slide-2",
        "name": "Gen Slide 2"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s3_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 3,\n    headline: prev.s3_headline,\n    subtext: prev.s3_subtext,\n    body_text: prev.s3_body,\n    image_prompt: prev.s3_prompt,\n    visual_style: prev.s3_style,\n    topic: prev.topic,\n    // Pass remaining slides\n    s4_id: prev.s4_id, s4_headline: prev.s4_headline, s4_subtext: prev.s4_subtext, s4_body: prev.s4_body, s4_prompt: prev.s4_prompt, s4_style: prev.s4_style,\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2950,
          -100
        ],
        "id": "get-slide-3",
        "name": "Get Slide 3"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3100,
          -100
        ],
        "id": "gen-slide-3",
        "name": "Gen Slide 3"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s4_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 4,\n    headline: prev.s4_headline,\n    subtext: prev.s4_subtext,\n    body_text: prev.s4_body,\n    image_prompt: prev.s4_prompt,\n    visual_style: prev.s4_style,\n    topic: prev.topic,\n    // Pass remaining slide\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3400,
          -100
        ],
        "id": "get-slide-4",
        "name": "Get Slide 4"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3550,
          -100
        ],
        "id": "gen-slide-4",
        "name": "Gen Slide 4"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s5_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 5,\n    headline: prev.s5_headline,\n    subtext: prev.s5_subtext,\n    body_text: prev.s5_body,\n    image_prompt: prev.s5_prompt,\n    visual_style: prev.s5_style,\n    topic: prev.topic,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3850,
          -100
        ],
        "id": "get-slide-5",
        "name": "Get Slide 5"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\nreturn [{ json: response }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          4000,
          -100
        ],
        "id": "gen-slide-5",
        "name": "Gen Slide 5"
      }
    ],
    "connections": {
      "Webhook - Carousel Gen": {
        "main": [
          [
            {
              "node": "Format Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Input": {
        "main": [
          [
            {
              "node": "Agent 1: Strategy Analyst",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Agent 1: Strategy Analyst",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Agent 2: Copywriter",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Agent 3: Visual Director",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Agent 1: Strategy Analyst": {
        "main": [
          [
            {
              "node": "Agent 2: Copywriter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent 2: Copywriter": {
        "main": [
          [
            {
              "node": "Agent 3: Visual Director",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent 3: Visual Director": {
        "main": [
          [
            {
              "node": "Parse Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Output": {
        "main": [
          [
            {
              "node": "Create Post Record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Post Record": {
        "main": [
          [
            {
              "node": "Prepare Slides",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Slides": {
        "main": [
          [
            {
              "node": "Insert Slides",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert Slides": {
        "main": [
          [
            {
              "node": "Get Slide 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 1": {
        "main": [
          [
            {
              "node": "Gen Slide 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 1": {
        "main": [
          [
            {
              "node": "Get Slide 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 2": {
        "main": [
          [
            {
              "node": "Gen Slide 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 2": {
        "main": [
          [
            {
              "node": "Get Slide 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 3": {
        "main": [
          [
            {
              "node": "Gen Slide 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 3": {
        "main": [
          [
            {
              "node": "Get Slide 4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 4": {
        "main": [
          [
            {
              "node": "Gen Slide 4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 4": {
        "main": [
          [
            {
              "node": "Get Slide 5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 5": {
        "main": [
          [
            {
              "node": "Gen Slide 5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    }
  }