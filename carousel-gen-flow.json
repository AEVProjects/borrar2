  {
    "name": "MSI Carousel Gen Flow v13",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "msi-carousel-v12",
          "responseMode": "lastNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          0,
          0
        ],
        "id": "webhook",
        "name": "Webhook - Carousel Gen"
      },
      {
        "parameters": {
          "jsCode": "// Format Input & Parse News\nconst input = $('Webhook - Carousel Gen').item.json;\nlet data = input.body || input;\nif (typeof data === 'string') {\n  try { data = JSON.parse(data); } catch(e) { data = input; }\n}\n\n// Handle news content specifically if present\nconst newsItems = data.news_items || [];\n// If individual fields are passed instead of array\nif (newsItems.length === 0 && (data.news_title || data.news_content)) {\n    newsItems.push({\n        title: data.news_title,\n        content: data.news_content,\n        source: data.news_source\n    });\n}\n\n// Extract rich content\nconst news1 = newsItems[0] || {};\nconst news2 = newsItems[1] || {};\nconst news3 = newsItems[2] || {};\n\nconst getContent = function(n) {\n  return (n.content || n.snippet || n.description || '').substring(0, 500);\n};\n\nreturn [{\n  json: {\n    // Original fields\n    topic: data.topic || news1.title || 'Tech Trends',\n    visual_style: 'Realistic Photography', // FORCE Realistic Photography\n    headline: data.headline || news1.title || '',\n    \n    // News Parsing\n    news_count: newsItems.length,\n    n1_title: news1.title || '',\n    n1_source: news1.source || '',\n    n1_content: getContent(news1),\n    n2_title: news2.title || '',\n    n2_source: news2.source || '',\n    n2_content: getContent(news2),\n    n3_title: news3.title || '',\n    n3_source: news3.source || '',\n    n3_content: getContent(news3),\n    \n    color_primary: data.color_primary || '#207CE5',\n    color_secondary: data.color_secondary || '#004AAD'\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          220,
          0
        ],
        "id": "format-input",
        "name": "Format Input"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=ANALYZE THESE NEWS ITEMS:\n\nNEWS 1: {{ $json.n1_title }}\nSource: {{ $json.n1_source }}\nContent: {{ $json.n1_content }}\n\nNEWS 2: {{ $json.n2_title }}\nSource: {{ $json.n2_source }}\nContent: {{ $json.n2_content }}\n\nNEWS 3: {{ $json.n3_title }}\nSource: {{ $json.n3_source }}\nContent: {{ $json.n3_content }}\n\nTOPIC: {{ $json.topic }}\n\nTASK:\n1. Identify the overarching NEWS THEME connecting these stories.\n2. Create a BREAKING NEWS style HOOK for Slide 1 (like a newspaper front page headline).\n3. For EACH news item, write a NEWS SUMMARY preserving the WHO, WHAT, WHEN, WHERE, WHY. Include specific facts, numbers, company names, and dates from the original articles. Do NOT generalize or turn them into advice/tips.\n4. Define the CTA for Slide 5.\n\nCRITICAL:\n- These are NEWS REPORTS, not tips or recommendations.\n- Use SIMPLE, EVERYDAY LANGUAGE. Write so anyone can understand, even without tech knowledge.\n- NO acronyms (spell them out or skip them). NO technical jargon. NO complex vocabulary.\n- Keep company names but simplify technical concepts into plain words.\n\nOUTPUT:\n- Theme: [News Theme in simple words]\n- Hook: [Breaking News Hook - simple and clear]\n- Summary 1: [News 1 summary in plain language]\n- Summary 2: [News 2 summary in plain language]\n- Summary 3: [News 3 summary in plain language]\n- CTA: [Call to Action]",
          "options": {
            "systemMessage": "# ROLE: Senior News Editor\nYou are a senior news editor preparing a NEWS BRIEFING for a general audience on a MSI Technologies carousel.\nYour job is to REPORT THE NEWS - what happened, who did it, and why it matters.\nNEVER convert news into tips, advice, or recommendations. These are NEWS STORIES - report them as such.\nUSE SIMPLE LANGUAGE that anyone can understand. NO acronyms (write 'Artificial Intelligence' not 'AI', 'Amazon Web Services' not 'AWS'). NO technical jargon. Write like a TV news anchor explaining to a broad audience."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          440,
          0
        ],
        "id": "agent-strategy",
        "name": "Agent 1: Strategy Analyst"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=STRATEGY INPUT:\n{{ $('Agent 1: Strategy Analyst').item.json.output }}\n\nCONTEXT:\nTheme: {{ $json.Theme }}\nNews 1: {{ $('Format Input').item.json.n1_title }}\nSource: {{ $('Format Input').item.json.n1_source }}\nContent: {{ $('Format Input').item.json.n1_content }}\n\nNews 2: {{ $('Format Input').item.json.n2_title }}\nSource: {{ $('Format Input').item.json.n2_source }}\nContent: {{ $('Format Input').item.json.n2_content }}\n\nNews 3: {{ $('Format Input').item.json.n3_title }}\nSource: {{ $('Format Input').item.json.n3_source }}\nContent: {{ $('Format Input').item.json.n3_content }}\n\nTASK:\nCreate a 5-slide Instagram Carousel structure (4:5 format).\nALL OUTPUT MUST BE IN ENGLISH.\nThese slides are a NEWS DIGEST - they report REAL NEWS that happened. NOT tips, NOT advice, NOT recommendations.\n\nSLIDE 1 (COVER - NEWS HEADLINE): \n- Headline: BREAKING NEWS style hook (5-8 words max). Write like a newspaper FRONT PAGE HEADLINE announcing today's top stories. Use ACTIVE VERBS in PRESENT TENSE (journalistic present). Examples: 'Big Tech Shakes Up The Industry' / 'Major Deals Reshape Cloud Market' / 'AI Race Heats Up This Week' / 'Three Stories Changing Tech Today'. NO jargon. NO colons. NO semicolons.\n- Subtext: LEAVE EMPTY.\n- Body: LEAVE EMPTY.\n\nSLIDE 2-4 (NEWS STORIES - REPORT THE FACTS): \n- Headline: NEWS HEADLINE (6-10 words). Write like a newspaper headline anyone can understand. Say WHO did WHAT in simple words. Use present tense. Name the company. Examples: 'Google Launches New Tool for Businesses' / 'Amazon Drops Cloud Prices by 40 Percent' / 'Hackers Attack Three Major US Banks'. NO acronyms. NO colons. NO semicolons. NO source names in headline.\n- Body: Write ONE SINGLE NEWS PARAGRAPH reporting what happened. Use SIMPLE, EVERYDAY WORDS that anyone can understand - like explaining to a friend. Keep company names but explain technical things in plain language. 15-25 words. Example: 'Google launched a new tool that helps businesses work faster. Early users report saving 35% on costs.'\n- FORBIDDEN in body: acronyms, technical jargon, 'you should', 'consider', 'make sure', 'tip', 'best practice', 'we recommend'. NO advice. ONLY report what happened in simple words.\n- Source: MANDATORY - Extract EXACT source name (TechCrunch, Reuters, Bloomberg, etc). Default: 'Industry Report'.\n\nSLIDE 5 (CTA): \n- Headline: Engaging question about the news. Examples: 'Want More Tech News?' / 'Stay Informed With Us' / 'Like Our News Digest?'\n- Subtext: Collaborative invitation. Examples: 'Let's Work Together' / 'Partner With Us' / 'Let's Build Something Great'\n- Body: LEAVE EMPTY (no body text for slide 5)\n- Contact Info: \"contact@msitechnologiesinc.com | msitechnologiesinc.com\"\n\nCRITICAL RULES:\n- Headlines = NEWSPAPER STYLE, name companies/entities, present tense\n- Body = ONE NEWS PARAGRAPH reporting FACTS with SPECIFIC DETAILS (names, numbers, dates)\n- Body MUST sound like a NEWS ARTICLE, NEVER like a tip or recommendation\n- Slide 5 has question headline + collaborative subtext\n- NO colons, NO semicolons anywhere\n\nOUTPUT JSON ARRAY:\n[\n  {\n    \"slide_number\": 1,\n    \"headline\": \"...\",\n    \"subtext\": \"...\",\n    \"body\": \"...\"\n  },\n  {\n    \"slide_number\": 2,\n    \"headline\": \"...\",\n    \"body\": \"...\",\n    \"source\": \"...\"\n  },\n  ... (5 slides total)\n]",
          "options": {
            "systemMessage": "# ROLE: TV News Writer (Simple & Clear)\nYou write NEWS REPORTS for Instagram carousels in ENGLISH. Your output sounds like a friendly TV news anchor.\n\nMANDATORY STYLE:\n- Write in THIRD PERSON, PAST TENSE. Example: 'The company announced...' / 'The deal is worth...'\n- Use SIMPLE, EVERYDAY WORDS. Write for a general audience, not tech experts.\n- Headlines use PRESENT TENSE: 'Microsoft Launches...' not 'Microsoft Launched...'\n- Keep company names but explain everything else in plain language.\n\nFORBIDDEN (will be rejected):\n- Acronyms (NO 'AI', 'ML', 'SaaS', 'API', 'ROI', 'B2B' - spell out or rephrase in simple words)\n- Technical jargon or complex vocabulary\n- Second person ('you', 'your')\n- Imperative mood ('consider', 'try', 'make sure')\n- Advisory language ('should', 'we recommend')\n- Marketing buzzwords ('game-changing', 'revolutionary', 'cutting-edge', 'disruptive')\n\nTone: Clear, simple, factual - like a news anchor explaining to everyone at home."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          760,
          0
        ],
        "id": "agent-copywriter",
        "name": "Agent 2: Copywriter"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=INPUT FROM COPYWRITER AGENT:\\n{{ $('Agent 2: Copywriter').item.json.output }}\\n\\nTASK:\\nFor EACH slide in the JSON array, create a detailed 'image_prompt' field.\\n\\nIMPORTANT: \\n- Add ONLY the 'image_prompt' field to each existing slide object\\n- Do NOT modify existing fields\\n- Return the EXACT same JSON structure with added image_prompt fields\\n\\nMSI BRAND GUIDELINES:\\n- COLORS: MSI Blue (#207CE5), Dark Blue (#004AAD), Cream (#FFFDF1)\\n- TYPOGRAPHY: ITC Avant Garde (headlines), Poppins (subheadings), Quicksand (body)\\n- LAYOUT: Split layout with 55% image top, 45% text bottom\\n- CONSISTENCY: All slides must look like MSI brand family\\n\\nFor each slide, create realistic photography prompts. Return valid JSON.",
          "options": {
            "systemMessage": "# ROLE: Expert Brand Designer (Instagram Visual Specialist)\nYour goal is CLEAN MINIMALISM & PROFESSIONALISM.\n- MINIMIZE PEOPLE in visuals. Use Tech/Architecture/Concepts.\n- NO TEXT SHADOWS. FLAT DESIGN.\n- SMALLER FONT for body text to guarantee 3 lines.\n- Slide Indicator must be REGULAR weight (NOT BOLD).\n- Slide 1 must be eye-catching but CLEAN.\n- Slides 2-4 must balance visuals with SHORT text (max 16 words).\n\nERROR HANDLING:\n- Always expect a JSON array input\n- If input is not valid JSON, return error message\n- If slides are missing required fields, use defaults\n- Always return valid JSON structure"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1080,
          0
        ],
        "id": "agent-visual",
        "name": "Agent 3: Visual Director"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "chatgpt-4o-latest",
            "mode": "list",
            "cachedResultName": "chatgpt-4o-latest"
          },
          "builtInTools": {},
          "options": {
            "responseFormat": "json_object"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          860,
          -240
        ],
        "id": "openai-model",
        "name": "OpenAI Model",
        "credentials": {
          "openAiApi": {
            "id": "13Oqly3WdRAzZVXL",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse Final JSON Output\nconst rawOutput = $('Agent 3: Visual Director').item.json.output;\nconst cleanedOutput = rawOutput.replace(/```json/g, '').replace(/```/g, '').trim();\nconst generated = JSON.parse(cleanedOutput);\nconst originalInput = $('Format Input').item.json;\n\n// Add metadata to each slide\nconst slides = generated.map(slide => ({\n    ...slide,\n    visual_style: originalInput.visual_style,\n    carousel_id: null\n}));\n\nreturn [{\n    json: {\n        slides: slides,\n        parent_post: {\n            topic: originalInput.topic,\n            headline: slides[0].headline,\n            visual_style: originalInput.visual_style,\n            post_type: 'Carousel',\n            status: 'generating_images'\n        }\n    }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1340,
          0
        ],
        "id": "parse-output",
        "name": "Parse Output"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "=INSERT INTO social_posts (topic, post_type, visual_style, orientation, headline, status, created_at)\nVALUES ('{{ $json.parent_post.topic.replace(/'/g, \"''\") }}', 'Carousel', '{{ $json.parent_post.visual_style }}', '4:5', '{{ $json.parent_post.headline.replace(/'/g, \"''\") }}', 'generating', NOW())\nRETURNING id",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1560,
          0
        ],
        "id": "create-post",
        "name": "Create Post Record",
        "credentials": {
          "postgres": {
            "id": "WnTYs2zvPoE7hDJE",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Prepare All Slides Data\nconst postId = $('Create Post Record').item.json.id;\nconst slides = $('Parse Output').item.json.slides;\nconst topic = $('Format Input').item.json.topic || 'Technology';\n\n// Return all slides as individual items for batch insert\n// Embed topic inside visual_style JSON since carousel_slides table doesn't have topic column\nconst slideItems = slides.map(slide => ({\n    json: {\n        carousel_id: postId,\n        slide_number: slide.slide_number,\n        headline: slide.headline,\n        subtext: slide.subtext || '',\n        body_text: slide.body || slide.body_text || '',\n        image_prompt: slide.image_prompt,\n        visual_style: JSON.stringify({ style: slide.visual_style, source: slide.source || '', topic: topic })\n    }\n}));\n\nreturn slideItems;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1700,
          0
        ],
        "id": "prepare-slides",
        "name": "Prepare Slides"
      },
      {
        "parameters": {
          "operation": "insert",
          "schema": {
            "__rl": true,
            "value": "public",
            "mode": "list",
            "cachedResultName": "public"
          },
          "table": {
            "__rl": true,
            "value": "carousel_slides",
            "mode": "list",
            "cachedResultName": "carousel_slides"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "carousel_id",
                "displayName": "carousel_id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "slide_number",
                "displayName": "slide_number",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "integer",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "headline",
                "displayName": "headline",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "subtext",
                "displayName": "subtext",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "body_text",
                "displayName": "body_text",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "image_prompt",
                "displayName": "image_prompt",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ]
          },
          "options": {
            "returnFields": "*"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1850,
          0
        ],
        "id": "insert-slides",
        "name": "Insert Slides",
        "credentials": {
          "postgres": {
            "id": "WnTYs2zvPoE7hDJE",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Get all inserted slides and prepare for sequential processing\nconst allInserted = $input.all().map(item => item.json);\n\n// Extract topic from visual_style JSON\nlet topic = 'Technology';\ntry {\n  const vsData = JSON.parse(allInserted[0].visual_style || '{}');\n  topic = vsData.topic || 'Technology';\n} catch(e) {}\n\n// Store all slides data for the chain\nconst s1 = allInserted[0];\nconst s2 = allInserted[1];\nconst s3 = allInserted[2];\nconst s4 = allInserted[3];\nconst s5 = allInserted[4];\n\nreturn [{\n  json: {\n    // Current slide to process\n    id: s1.id,\n    carousel_id: s1.carousel_id,\n    slide_number: s1.slide_number,\n    headline: s1.headline || '',\n    subtext: s1.subtext || '',\n    body_text: s1.body_text || '',\n    image_prompt: s1.image_prompt || '',\n    visual_style: s1.visual_style || '',\n    topic: topic,\n    // All slides for the chain\n    s2_id: s2.id, s2_headline: s2.headline || '', s2_subtext: s2.subtext || '', s2_body: s2.body_text || '', s2_prompt: s2.image_prompt || '', s2_style: s2.visual_style || '',\n    s3_id: s3.id, s3_headline: s3.headline || '', s3_subtext: s3.subtext || '', s3_body: s3.body_text || '', s3_prompt: s3.image_prompt || '', s3_style: s3.visual_style || '',\n    s4_id: s4.id, s4_headline: s4.headline || '', s4_subtext: s4.subtext || '', s4_body: s4.body_text || '', s4_prompt: s4.image_prompt || '', s4_style: s4.visual_style || '',\n    s5_id: s5.id, s5_headline: s5.headline || '', s5_subtext: s5.subtext || '', s5_body: s5.body_text || '', s5_prompt: s5.image_prompt || '', s5_style: s5.visual_style || '',\n    carousel_id_shared: s1.carousel_id\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2050,
          -100
        ],
        "id": "get-slide-1",
        "name": "Get Slide 1"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2200,
          -100
        ],
        "id": "gen-slide-1",
        "name": "Gen Slide 1"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s2_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 2,\n    headline: prev.s2_headline,\n    subtext: prev.s2_subtext,\n    body_text: prev.s2_body,\n    image_prompt: prev.s2_prompt,\n    visual_style: prev.s2_style,\n    topic: prev.topic,\n    // Pass remaining slides\n    s3_id: prev.s3_id, s3_headline: prev.s3_headline, s3_subtext: prev.s3_subtext, s3_body: prev.s3_body, s3_prompt: prev.s3_prompt, s3_style: prev.s3_style,\n    s4_id: prev.s4_id, s4_headline: prev.s4_headline, s4_subtext: prev.s4_subtext, s4_body: prev.s4_body, s4_prompt: prev.s4_prompt, s4_style: prev.s4_style,\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2500,
          -100
        ],
        "id": "get-slide-2",
        "name": "Get Slide 2"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2650,
          -100
        ],
        "id": "gen-slide-2",
        "name": "Gen Slide 2"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s3_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 3,\n    headline: prev.s3_headline,\n    subtext: prev.s3_subtext,\n    body_text: prev.s3_body,\n    image_prompt: prev.s3_prompt,\n    visual_style: prev.s3_style,\n    topic: prev.topic,\n    // Pass remaining slides\n    s4_id: prev.s4_id, s4_headline: prev.s4_headline, s4_subtext: prev.s4_subtext, s4_body: prev.s4_body, s4_prompt: prev.s4_prompt, s4_style: prev.s4_style,\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2950,
          -100
        ],
        "id": "get-slide-3",
        "name": "Get Slide 3"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3100,
          -100
        ],
        "id": "gen-slide-3",
        "name": "Gen Slide 3"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s4_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 4,\n    headline: prev.s4_headline,\n    subtext: prev.s4_subtext,\n    body_text: prev.s4_body,\n    image_prompt: prev.s4_prompt,\n    visual_style: prev.s4_style,\n    topic: prev.topic,\n    // Pass remaining slide\n    s5_id: prev.s5_id, s5_headline: prev.s5_headline, s5_subtext: prev.s5_subtext, s5_body: prev.s5_body, s5_prompt: prev.s5_prompt, s5_style: prev.s5_style,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3400,
          -100
        ],
        "id": "get-slide-4",
        "name": "Get Slide 4"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\n// Pass all slide data to next node\nreturn [{ json: { ...response, ...input } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3550,
          -100
        ],
        "id": "gen-slide-4",
        "name": "Gen Slide 4"
      },

      {
        "parameters": {
          "jsCode": "const prev = $input.first().json;\n\nreturn [{\n  json: {\n    id: prev.s5_id,\n    carousel_id: prev.carousel_id_shared,\n    slide_number: 5,\n    headline: prev.s5_headline,\n    subtext: prev.s5_subtext,\n    body_text: prev.s5_body,\n    image_prompt: prev.s5_prompt,\n    visual_style: prev.s5_style,\n    topic: prev.topic,\n    carousel_id_shared: prev.carousel_id_shared\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3850,
          -100
        ],
        "id": "get-slide-5",
        "name": "Get Slide 5"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.first().json;\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://n8nmsi.app.n8n.cloud/webhook/msi-slide-gen',\n  body: {\n    slide_id: input.id,\n    image_prompt: input.image_prompt,\n    carousel_id: input.carousel_id,\n    slide_number: input.slide_number,\n    headline: input.headline,\n    subtext: input.subtext,\n    body_text: input.body_text,\n    visual_style: input.visual_style,\n    topic: input.topic\n  },\n  json: true\n});\n\nreturn [{ json: response }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          4000,
          -100
        ],
        "id": "gen-slide-5",
        "name": "Gen Slide 5"
      }
    ],
    "connections": {
      "Webhook - Carousel Gen": {
        "main": [
          [
            {
              "node": "Format Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Input": {
        "main": [
          [
            {
              "node": "Agent 1: Strategy Analyst",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Agent 1: Strategy Analyst",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Agent 2: Copywriter",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Agent 3: Visual Director",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Agent 1: Strategy Analyst": {
        "main": [
          [
            {
              "node": "Agent 2: Copywriter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent 2: Copywriter": {
        "main": [
          [
            {
              "node": "Agent 3: Visual Director",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent 3: Visual Director": {
        "main": [
          [
            {
              "node": "Parse Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Output": {
        "main": [
          [
            {
              "node": "Create Post Record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Post Record": {
        "main": [
          [
            {
              "node": "Prepare Slides",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Slides": {
        "main": [
          [
            {
              "node": "Insert Slides",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert Slides": {
        "main": [
          [
            {
              "node": "Get Slide 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 1": {
        "main": [
          [
            {
              "node": "Gen Slide 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 1": {
        "main": [
          [
            {
              "node": "Get Slide 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 2": {
        "main": [
          [
            {
              "node": "Gen Slide 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 2": {
        "main": [
          [
            {
              "node": "Get Slide 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 3": {
        "main": [
          [
            {
              "node": "Gen Slide 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 3": {
        "main": [
          [
            {
              "node": "Get Slide 4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 4": {
        "main": [
          [
            {
              "node": "Gen Slide 4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gen Slide 4": {
        "main": [
          [
            {
              "node": "Get Slide 5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Slide 5": {
        "main": [
          [
            {
              "node": "Gen Slide 5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    }
  }